<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <TITLE>Snowing animation inside a website</TITLE>
  <STYLE type="text/css">
    :root {
      --snowflake-color: #000000;
    }

    body {
      background-color: grey;
    }

    .snowflake {
      color: var(--snowflake-color);
      text-shadow: 0 0 10px #000;
      position: fixed;
      top: 0%;
      z-index: 9999;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      cursor: help;
    }
  </style>
</HEAD>

<BODY>
  <div class="snowflakes" aria-hidden="true">

  </div>
  <script type='text/javascript'>
    //<![CDATA[
    let startSnowflakeCode = 10052;
    var globalID;
    var b = 0;
    var startTime = 0;
    var red = 255;
    var green = 0;
    var blue = 0;
    var snowflakeCount = 25;
    var elapsed = 0;
    var fps = 50;
    var frameDeltaMillis = 1000 / fps;
    var lastSimulationTime = 0;
    var simulationTime = 0;

    var r = document.querySelector(':root');

    function componentToHex(c) {
      var hex = c.toString(16);
      return hex.length == 1 ? "0" + hex : hex;
    }

    function rgbToHex(r, g, b) {
      return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
    }

    function updateCurrentSimulationTime() {
      simulationTime = performance.now();
    }

    /**
 * @param {String} HTML representing a single element
 * @return {Element}
 */
    function htmlToElement(html) {
      var template = document.createElement('template');
      html = html.trim(); // Never return a text node of whitespace as the result
      template.innerHTML = html;
      return template.content.firstChild;
    }

    function simulateChristmasTreeLights(snowflake) {
      var rs = getComputedStyle(r);
      var color = rs.getPropertyValue('--snowflake-color');

      let rnd = Math.random() * 100;
      if (rnd > 30) {
        if (red > 246) {
          red = 100;
        }

        red += 30;
      }

      if (b === 0) {
        if (green > 256) {
          green = 0;
        }
        green = green + 10;
        r.style.setProperty('--snowflake-color', rgbToHex(red, green, blue));
        b = 1;
      } else {
        if (blue > 256) {
          blue = 0;
        }
        blue = blue + 10;
        r.style.setProperty('--snowflake-color', rgbToHex(red, green, blue));
        b = 0;
      }
    }

    function changeSnowflakesPositions(snowflake) {
      let top = snowflake.style['top'];
      if (top) {
        let topIntValue = parseFloat(top.split('px')[0], 10);
        if (topIntValue < window.innerHeight) {
          topIntValue += 2.5;
          let originalLeft = snowflake['originalLeft'];
          let cfv = snowflake['currentMotionFunctionValue'];
          if (cfv > 6.28) {
            cfv = 0;
          } else {
            cfv += 0.01;
          }

          let motionFunctionVal = Math.sin(cfv);
          let newLeft = originalLeft + 50 * motionFunctionVal;
          snowflake['currentMotionFunctionValue'] = cfv;
          snowflake.style['left'] = newLeft + 'px';
          //console.log('Cfv: ' + cfv + '; motionFunctionVal:' + motionFunctionVal + '; newLeft:' + newLeft);
        } else {
          topIntValue = -20;
          snowflake['currentMotionFunctionValue'] = 6.28 * Math.random();
        }
        top = topIntValue + 'px';
      } else {
        top = '0px';
      }

      snowflake.style['top'] = top;
    }

    function runSnow() {
      if (simulationTime - lastSimulationTime > frameDeltaMillis) {
        let snowflakes = document.getElementsByClassName('snowflake');
        for (let i = 0; i < snowflakes.length; i++) {
          simulateChristmasTreeLights(snowflakes[i]);
          changeSnowflakesPositions(snowflakes[i]);
        }

        lastSimulationTime = simulationTime;
      }

      updateCurrentSimulationTime();

      globalID = requestAnimationFrame(runSnow);
    }

    function getNextSnowflakeCode(i) {
      return '&#x' + (startSnowflakeCode + (i % 8)).toString(16) + ';';
    }

    function addNewSnowflake(container, snowflakeCode, leftPosition) {
      let sf = htmlToElement('<div class="snowflake">' + snowflakeCode + '</div>');
      sf.style['left'] = leftPosition + 'px';
      sf['originalLeft'] = leftPosition;
      sf['currentMotionFunctionValue'] = 6.28 * Math.random();
      sf.style['top'] = (Math.random() * -window.innerHeight) + 'px';
      container.appendChild(sf);
    }

    function createSnowflakes() {
      let snowflakesContainer = document.getElementsByClassName('snowflakes')[0];
      let step = window.innerWidth / snowflakeCount;
      for (let i = 0; i < snowflakeCount; i++) {
        addNewSnowflake(snowflakesContainer, getNextSnowflakeCode(i), (1 + i * step));
      }
    }

    createSnowflakes();

    globalID = requestAnimationFrame(runSnow);
//]]>
  </script>
</BODY>

</HTML>